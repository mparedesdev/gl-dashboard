<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RENAGRO Dashboard</title>
  
  <!-- Angular Material CSS -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@angular/material@15.2.9/prebuilt-themes/indigo-pink.css" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
  
  <!-- Chart.js -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.min.css">
  
  <style id="app-style">
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      background-color: #f5f5f5;
      color: #333;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .app-header {
      background-color: #3f51b5;
      color: white;
      padding: 12px 24px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    .app-title {
      font-size: 24px;
      font-weight: 500;
      margin: 0;
      flex-grow: 1;
    }

    .app-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      padding: 12px 24px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .filter-select {
      min-width: 140px;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      background-color: white;
    }

    .app-navigation {
      display: flex;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .nav-tab {
      padding: 12px 24px;
      text-align: center;
      cursor: pointer;
      flex-grow: 1;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .nav-tab.active {
      border-bottom-color: #3f51b5;
      color: #3f51b5;
    }

    .tab-content {
      display: none;
      padding: 24px;
      overflow-y: auto;
      flex-grow: 1;
    }

    .tab-content.active {
      display: block;
    }

    .dashboard-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 500;
      margin-top: 0;
      margin-bottom: 16px;
      color: #3f51b5;
    }

    .chart-container {
      height: 300px;
      position: relative;
    }

    .statistics-container {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .stat-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 16px;
      flex: 1;
      min-width: 200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #3f51b5;
      margin: 8px 0;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
    }
    
    .stat-icon {
      width: 32px;
      height: 32px;
      margin-bottom: 8px;
    }

    #map { 
      height: 500px;
      border-radius: 8px;
    }

    .map-legend {
      background: white;
      padding: 10px;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 200px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }

    @media (max-width: 768px) {
      .app-filters {
        flex-direction: column;
        gap: 8px;
      }
      
      .filter-select {
        width: 100%;
      }
      
      .statistics-container {
        flex-direction: column;
      }
      
      .stat-card {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1 class="app-title">RENAGRO</h1>
    </header>
    
    <div class="app-filters">
      <select class="filter-select" id="anio-select">
        <option value="">Año</option>
        <option value="2025">2025</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
      </select>
      
      <select class="filter-select" id="zona-select">
        <option value="">Zona</option>
        <option value="zona1">Zona 1</option>
        <option value="zona2">Zona 2</option>
        <option value="zona3">Zona 3</option>
      </select>
      
      <select class="filter-select" id="provincia-select">
        <option value="">Provincia</option>
        <option value="pichincha">Pichincha</option>
        <option value="guayas">Guayas</option>
        <option value="azuay">Azuay</option>
        <option value="manabi">Manabí</option>
      </select>
      
      <select class="filter-select" id="region-select">
        <option value="">Región</option>
        <option value="sierra">Sierra</option>
        <option value="costa">Costa</option>
        <option value="oriente">Oriente</option>
        <option value="insular">Insular</option>
      </select>
      
      <select class="filter-select" id="parroquia-select">
        <option value="">Parroquia</option>
        <option value="parroquia1">Parroquia 1</option>
        <option value="parroquia2">Parroquia 2</option>
        <option value="parroquia3">Parroquia 3</option>
      </select>
    </div>
    
    <nav class="app-navigation">
      <div class="nav-tab active" data-tab="info-principal">Información Principal</div>
      <div class="nav-tab" data-tab="seguimiento-monitoreo">Seguimiento y Monitoreo</div>
    </nav>
    
    <div id="info-principal" class="tab-content active">
      <div class="dashboard-card">
        <h3 class="card-title">Uso de Suelo y Hectáreas</h3>
        <div class="chart-container">
          <canvas id="pieChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h3 class="card-title">Principales Cultivos</h3>
        <div class="chart-container">
          <canvas id="barChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h3 class="card-title">Existencia de Animales (Unidades)</h3>
        <div class="statistics-container">
          <div class="stat-card">
            <img src="/assets/icons/cow.png" class="stat-icon" alt="Cow">
            <div class="stat-value" id="ganado-vacuno">12,345</div>
            <div class="stat-label">Ganado Vacuno</div>
          </div>
          <div class="stat-card">
            <img src="/assets/icons/chicken.png" class="stat-icon" alt="Chicken">
            <div class="stat-value" id="pollos">78,901</div>
            <div class="stat-label">Pollos</div>
          </div>
          <div class="stat-card">
            <img src="/assets/icons/pig.png" class="stat-icon" alt="Pig">
            <div class="stat-value" id="ganado-porcino">23,456</div>
            <div class="stat-label">Ganado Porcino</div>
          </div>
          <div class="stat-card">
            <img src="/assets/icons/sheep.png" class="stat-icon" alt="Sheep">
            <div class="stat-value" id="ganado-ovino">7,890</div>
            <div class="stat-label">Ganado Ovino</div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="seguimiento-monitoreo" class="tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Mapa de Levantamientos por Provincia</h3>
        <div id="map"></div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script id="app-script">
    // Navigation Tabs
    const tabs = document.querySelectorAll('.nav-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetId = tab.getAttribute('data-tab');
        
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(targetId).classList.add('active');
        
        if (targetId === 'seguimiento-monitoreo') {
          // Initialize or refresh the map when the tab becomes visible
          setTimeout(() => {
            if (map) map.invalidateSize();
          }, 10);
        }
      });
    });
    
    // Filter Change Event
    const filters = document.querySelectorAll('.filter-select');
    filters.forEach(filter => {
      filter.addEventListener('change', updateDashboard);
    });
    
    function updateDashboard() {
      // Get filter values
      const anio = document.getElementById('anio-select').value;
      const zona = document.getElementById('zona-select').value;
      const provincia = document.getElementById('provincia-select').value;
      const region = document.getElementById('region-select').value;
      const parroquia = document.getElementById('parroquia-select').value;
      
      // Here we would typically fetch data from APIs with the filters
      // For now, we'll just update our charts and stats with dummy data
      updatePieChart();
      updateBarChart();
      updateAnimalStats();
      updateMap();
    }
    
    // Initialize Pie Chart
    let pieChart;
    function initPieChart() {
      const ctx = document.getElementById('pieChart').getContext('2d');
      pieChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Cultivos', 'Pastizales', 'Bosques', 'Otros usos'],
          datasets: [{
            data: [35, 25, 30, 10],
            backgroundColor: [
              '#4CAF50',
              '#8BC34A',
              '#2196F3',
              '#9E9E9E'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            },
            title: {
              display: true,
              text: 'Distribución de Uso de Suelo (Hectáreas)'
            }
          }
        }
      });
    }
    
    function updatePieChart() {
      // In a real app, we'd fetch data here
      // For the prototype, we just simulate a chart update
      if (pieChart) {
        pieChart.data.datasets[0].data = [
          Math.floor(Math.random() * 40) + 20,
          Math.floor(Math.random() * 30) + 15,
          Math.floor(Math.random() * 35) + 10,
          Math.floor(Math.random() * 20) + 5
        ];
        pieChart.update();
      }
    }
    
    // Initialize Bar Chart
    let barChart;
    function initBarChart() {
      const ctx = document.getElementById('barChart').getContext('2d');
      barChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Cacao', 'Palma Africana', 'Plátano', 'Maíz Duro', 'Arroz'],
          datasets: [
            {
              label: 'Cultivos Permanentes',
              data: [120, 150, 80, null, null],
              backgroundColor: '#4CAF50',
              borderWidth: 1
            },
            {
              label: 'Cultivos Transitorios',
              data: [null, null, null, 130, 90],
              backgroundColor: '#2196F3',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Principales Cultivos (Hectáreas)'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Hectáreas'
              }
            }
          }
        }
      });
    }
    
    function updateBarChart() {
      // In a real app, we'd fetch data here
      // For the prototype, we just simulate a chart update
      if (barChart) {
        barChart.data.datasets[0].data = [
          Math.floor(Math.random() * 100) + 80,
          Math.floor(Math.random() * 100) + 100,
          Math.floor(Math.random() * 100) + 60,
          null,
          null
        ];
        barChart.data.datasets[1].data = [
          null,
          null,
          null,
          Math.floor(Math.random() * 100) + 90,
          Math.floor(Math.random() * 100) + 70
        ];
        barChart.update();
      }
    }
    
    // Animal Stats
    function updateAnimalStats() {
      // In a real app, we'd fetch data here
      // For the prototype, we just update the display with random numbers
      document.getElementById('ganado-vacuno').textContent = 
        numberWithCommas(Math.floor(Math.random() * 20000) + 10000);
      document.getElementById('pollos').textContent = 
        numberWithCommas(Math.floor(Math.random() * 50000) + 50000);
      document.getElementById('ganado-porcino').textContent = 
        numberWithCommas(Math.floor(Math.random() * 15000) + 20000);
      document.getElementById('ganado-ovino').textContent = 
        numberWithCommas(Math.floor(Math.random() * 5000) + 5000);
    }
    
    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // Initialize Ecuador Map
    let map;
    function initMap() {
      map = L.map('map').setView([-1.831239, -78.183406], 7);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      
      // We'd load GeoJSON for Ecuador provinces here
      // For prototype, we'll create a simple polygon
      const provinciasData = {
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": { "name": "Pichincha", "levantamientos": 145 },
            "geometry": {
              "type": "Polygon",
              "coordinates": [[[-78.5, -0.1], [-78.7, -0.3], [-78.3, -0.5], [-78.1, -0.2], [-78.5, -0.1]]]
            }
          },
          {
            "type": "Feature",
            "properties": { "name": "Guayas", "levantamientos": 210 },
            "geometry": {
              "type": "Polygon",
              "coordinates": [[[-79.9, -2.1], [-80.1, -2.3], [-79.7, -2.5], [-79.5, -2.2], [-79.9, -2.1]]]
            }
          },
          {
            "type": "Feature",
            "properties": { "name": "Manabí", "levantamientos": 75 },
            "geometry": {
              "type": "Polygon",
              "coordinates": [[[-80.2, -0.6], [-80.4, -0.8], [-80.0, -1.0], [-79.8, -0.7], [-80.2, -0.6]]]
            }
          },
          {
            "type": "Feature",
            "properties": { "name": "Azuay", "levantamientos": 95 },
            "geometry": {
              "type": "Polygon",
              "coordinates": [[[-79.0, -2.8], [-79.2, -3.0], [-78.8, -3.2], [-78.6, -2.9], [-79.0, -2.8]]]
            }
          }
        ]
      };

      function getColor(levantamientos) {
        return levantamientos > 150 ? '#1a9641' :  // Alto
               levantamientos > 100 ? '#a6d96a' :  // Medio-Alto
               levantamientos > 50 ? '#ffffbf' :   // Medio
               '#fdae61';                          // Bajo
      }

      function style(feature) {
        return {
          fillColor: getColor(feature.properties.levantamientos),
          weight: 2,
          opacity: 1,
          color: 'white',
          dashArray: '3',
          fillOpacity: 0.7
        };
      }
      
      function highlightFeature(e) {
        const layer = e.target;
        layer.setStyle({
          weight: 3,
          color: '#666',
          dashArray: '',
          fillOpacity: 0.7
        });
        layer.bringToFront();
        layer.bindPopup(
          `<b>${layer.feature.properties.name}</b><br>
          Levantamientos: ${layer.feature.properties.levantamientos}`
        ).openPopup();
      }

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
      }

      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: highlightFeature
        });
      }

      const geojson = L.geoJSON(provinciasData, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map);

      // Add a legend
      const legend = L.control({position: 'bottomright'});
      legend.onAdd = function(map) {
        const div = L.DomUtil.create('div', 'map-legend');
        const grades = [0, 50, 100, 150];
        const labels = ['Bajo', 'Medio', 'Medio-Alto', 'Alto'];
        const colors = ['#fdae61', '#ffffbf', '#a6d96a', '#1a9641'];
        
        div.innerHTML = '<h4>Levantamientos</h4>';
        
        for (let i = 0; i < grades.length; i++) {
          div.innerHTML += `
            <div class="legend-item">
              <div class="legend-color" style="background:${colors[i]}"></div>
              <span>${labels[i]}</span>
            </div>
          `;
        }
        return div;
      };
      legend.addTo(map);
    }
    
    function updateMap() {
      // In a real app, we'd update the map based on new data
      // For the prototype, we'll leave the map as is
    }
    
    // Initialize everything
    document.addEventListener('DOMContentLoaded', () => {
      initPieChart();
      initBarChart();
      initMap();
      updateDashboard();
    });
  </script>
</body>
</html>